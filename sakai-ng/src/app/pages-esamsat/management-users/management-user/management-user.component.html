<h4>Manajemen User</h4>
<p-card class="mb-4">
    <div class="flex justify-content-between align-items-center mb-3">
        <button
            pButton
            pRipple
            label="Tambah Data"
            icon="pi pi-plus"
            routerLink="/management-users/register-user"
        ></button>
    </div>

    <!-- Filter -->
    <div class="flex gap-3 mb-3">
        <div class="p-inputgroup">
            <span class="p-inputgroup-addon">
                <i class="pi pi-search"></i>
            </span>
            <input
                #searchBox
                pInputText
                type="text"
                placeholder="Search"
                (input)="dt.filterGlobal(searchBox.value, 'contains')"
                class="w-full"
            />
        </div>
    </div>

    <p-table
        #dt
        [value]="users"
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20]"
        responsiveLayout="scroll"
        class="p-datatable-gridlines p-datatable-sm"
        [globalFilterFields]="['nama', 'email', 'kdgroup']"
        [sortField]="'createdate'"
        [sortOrder]="-1"
    >
        <!-- -1 untuk urut terbaru, 1 untuk terlama -->>
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="userid">
                    UserID <p-sortIcon field="userid"></p-sortIcon>
                </th>
                <th pSortableColumn="nama">
                    Nama <p-sortIcon field="nama"></p-sortIcon>
                </th>
                <th pSortableColumn="email">
                    Email <p-sortIcon field="email"></p-sortIcon>
                </th>
                <th pSortableColumn="kdgroup">
                    Group <p-sortIcon field="kdgroup"></p-sortIcon>
                </th>
                <th pSortableColumn="createdate">
                    Tanggal Dibuat <p-sortIcon field="createdate"></p-sortIcon>
                </th>
                <th style="width: 120px; text-align: center">Aksi</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
            <tr>
                <td>{{ user.userid }}</td>
                <td>{{ user.nama }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.kdgroup }}</td>
                <td>{{ user.createdate | date : "dd/MM/yyyy" }}</td>
                <td class="text-center">
                    <p-button
                        icon="pi pi-user-edit"
                        styleClass="p-button-text p-button-sm mr-2"
                        (click)="openEditDialog(user)"
                    >
                    </p-button>
                    <p-button
                        icon="pi pi-trash"
                        styleClass="p-button-text p-button-sm p-button-danger"
                        (click)="confirmDelete(user)"
                    >
                    </p-button>
                </td>
            </tr>
        </ng-template>
    </p-table>
</p-card>

<!-- Dialog Edit -->
<p-dialog
    header="Edit User"
    [(visible)]="editDialogVisible"
    [modal]="true"
    [style]="{ width: '400px' }"
>
    <div class="card p-fluid">
        <div class="field">
            <label for="nama">Nama</label>
            <input
                id="nama"
                type="text"
                pInputText
                [(ngModel)]="selectedUser.nama"
            />
        </div>
        <div class="field">
            <label for="email">Email</label>
            <input
                id="email"
                type="email"
                pInputText
                [(ngModel)]="selectedUser.email"
            />
        </div>
        <div class="field">
            <label for="kdgroup">Group</label>
            <p-dropdown
                id="kdgroup"
                [options]="dropdownItems"
                [(ngModel)]="selectedUser.kdgroup"
                optionLabel="label"
                optionValue="value"
                placeholder="Pilih Group"
                class="w-full"
            ></p-dropdown>
        </div>
        <div class="field">
            <label for="password">Password</label>
            <input
                id="password"
                type="password"
                pInputText
                [(ngModel)]="selectedUser.password"
            />
        </div>
        <div class="field">
            <p-button
                label="Simpan"
                icon="pi pi-check"
                [loading]="loading"
                (click)="saveUser()"
                styleClass="p-button-success"
            ></p-button>
        </div>
    </div>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
<p-toast></p-toast>
